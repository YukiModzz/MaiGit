'use strict';
const { request } = require('undici');
exports.request = async (url, options) => {
    const {
        requestOptions
    } = options;
    const {
        statusCode,
        headers,
        body
    } = await request(url, options);
    const code = statusCode.toString();
    if (code.startsWith('2')) return body.text();
    if (code.startsWith('3')) return exports.request(headers.location, options);
    const e = new Error(`Failed to request with status code: ${code}`);
    e.statusCode = statusCode;
    throw e;
};
